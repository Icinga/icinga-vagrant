---
filebeat:
  prospectors:
    - input_type: <%= @input_type %>
      paths:
        <%- @paths.each do |log_path| -%>
        - <%= log_path %>
        <%- end -%>
      <%- if @encoding -%>
      encoding: <%= @encoding %>
      <%- end -%>
      <%- if @include_lines.length > 0 -%>
      include_lines:
        <%- @include_lines.each do |include_line| -%>
        - '<%= include_line %>'
        <%- end -%>
      <%- end -%>
      <%- if @exclude_lines.length > 0 -%>
      exclude_lines:
        <%- @exclude_lines.each do |exclude_line| -%>
        - '<%= exclude_line %>'
        <%- end -%>
      <%- end -%>
      <%- if @exclude_files.length > 0 -%>
      exclude_files:
        <%- @exclude_files.each do |exclude_file| -%>
        - <%= exclude_file %>
        <%- end -%>
      <%- end -%>
      <%- if @fields.length > 0 -%>
      fields:
        <%- @fields.each_pair do |k, v| -%>
        <%= k %>: <%= v %>
        <%- end -%>
      <%- end -%>
      fields_under_root: <%= @fields_under_root %>
      <%- if @ignore_older -%>
      ignore_older: <%= @ignore_older %>
      <%- end -%>
      <%- if @doc_type -%>
      document_type: <%= @doc_type %>
      <%- end -%>
      <%- if @scan_frequency -%>
      scan_frequency: <%= @scan_frequency %>
      <%- end -%>
      <%- if @harvester_buffer_size -%>
      harvester_buffer_size: <%= @harvester_buffer_size %>
      <%- end -%>
      <%- if @max_bytes -%>
      max_bytes: <%= @max_bytes %>
      <%- end -%>

      ### JSON configuration

      # Decode JSON options. Enable this if your logs are structured in JSON.
      # JSON key on which to apply the line filtering and multiline settings. This key
      # must be top level and its value must be string, otherwise it is ignored. If
      # no text key is defined, the line filtering and multiline features cannot be used.
      #json.message_key:

      # By default, the decoded JSON is placed under a "json" key in the output document.
      # If you enable this setting, the keys are copied top level in the output document.
      #json.keys_under_root: false

      # If keys_under_root and this setting are enabled, then the values from the decoded
      # JSON object overwrite the fields that Filebeat normally adds (type, source, offset, etc.)
      # in case of conflicts.
      #json.overwrite_keys: false

      # If this setting is enabled, Filebeat adds a "json_error" key in case of JSON
      # unmarshaling errors or when a text key is defined in the configuration but cannot
      # be used.
      #json.add_error_key: false

      <%- if @multiline.length > 0 -%>
      multiline:
        <%- if @multiline['pattern'] -%>
        pattern: '<%= @multiline['pattern'] %>'
        <%- end -%>
        <%- if @multiline['negate'] -%>
        negate: <%= @multiline['negate'] %>
        <%- end -%>
        <%- if @multiline['match'] -%>
        match: <%= @multiline['match'] %>
        <%- end -%>
        <%- if @multiline['max_lines'] -%>
        max_lines: <%= @multiline['max_lines'] %>
        <%- end -%>
        <%- if @multiline['timeout'] -%>
        timeout: <%= @multiline['timeout'] %>
        <%- end -%>
      <%- end -%>
      tail_files: <%= @tail_files %>

      # Experimental: If symlinks is enabled, symlinks are opened and harvested. The harvester is openening the
      # original for harvesting but will report the symlink name as source.
      #symlinks: false

      <%- if @backoff -%>
      backoff: <%= @backoff %>
      <%- end -%>
      <%- if @max_backoff -%>
      max_backoff: <%= @max_backoff %>
      <%- end -%>
      <%- if @backoff_factor -%>
      backoff_factor: <%= @backoff_factor %>
      <%- end -%>

      # Experimental: Max number of harvesters that are started in parallel.
      # Default is 0 which means unlimited
      #harvester_limit: 0

      ### Harvester closing options

      # Close inactive closes the file handler after the predefined period.
      # The period starts when the last line of the file was, not the file ModTime.
      # Time strings like 2h (2 hours), 5m (5 minutes) can be used.
      #close_inactive: 5m

      # Close renamed closes a file handler when the file is renamed or rotated.
      # Note: Potential data loss. Make sure to read and understand the docs for this option.
      #close_renamed: false

      # When enabling this option, a file handler is closed immediately in case a file can't be found
      # any more. In case the file shows up again later, harvesting will continue at the last known position
      # after scan_frequency.
      #close_removed: true

      # Closes the file handler as soon as the harvesters reaches the end of the file.
      # By default this option is disabled.
      # Note: Potential data loss. Make sure to read and understand the docs for this option.
      #close_eof: false

      ### State options

      # Files for the modification data is older then clean_inactive the state from the registry is removed
      # By default this is disabled.
      #clean_inactive: 0

      # Removes the state for file which cannot be found on disk anymore immediately
      #clean_removed: true

      # Close timeout closes the harvester after the predefined time.
      # This is independent if the harvester did finish reading the file or not.
      # By default this option is disabled.
      # Note: Potential data loss. Make sure to read and understand the docs for this option.
      #close_timeout: 0
